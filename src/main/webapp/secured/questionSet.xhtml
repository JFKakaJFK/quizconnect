<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough" xmlns:qc="http://java.sun.com/jsf/composite/quizconnect"
                template="/WEB-INF/templates/main.xhtml">
    <ui:define name="site-specific-css">
        <link rel="stylesheet" type="text/css" href="/resources/css/editquestionset.css"/>
        <link rel="stylesheet" type="text/css" href="/resources/css/login.css"/>
        <script type="text/javascript" src="../resources/quizconnect/js/QCUpload.js"></script>
    </ui:define>

    <ui:define name="content">
        <div class="container pt-5 reduced-mobile-spacing">
            <div class="row py-3">
                <div class="col-lg">
                    <h1 class="display-4 text-center">Create a new QuestionSet</h1>
                </div>
            </div>
        </div>

        <div class="container-fluid mt-5 reduced-mobile-margin" id="responsive-formgroup">
            <h:form id="questionSetForm" rendered="#{questionSetBean.questionSet.name == null}">

                <div class="form-group">
                    <label for="setName">Set name</label>
                    <h:inputText type="text" styleClass="form-control" value="#{questionSetBean.questionSet.name}"
                                 name="setName" id="setName" pt:placeholder="Music theory" pt:autocomplete="off"
                                 pt:required="true"/>
                </div>

                <div class="form-group">
                    <label for="setDesc">Description</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.questionSet.description}"
                                 name="setDesc" id="setDesc" pt:placeholder="Easy questions based on semester 1"
                                 pt:autocomplete="off"/>
                </div>

                <div class="container-fluid mx-0 px-0 my-5">
                    <div class="row">
                        <ui:repeat id="items" value="#{questionSetBean.difficulty}" var="diff">


                            <div class="form-check form-check-inline w-50 mx-0 px-0 justify-content-center">
                                <input type="radio" class="form-check-input" jsf:id="difficulty"
                                       pt:name="#{hiddenIt.clientId}"
                                       value="#{diff}"
                                       pt:checked="#{diff eq questionSetBean.questionSet.difficulty ? 'checked' : null}"/>
                                <h:outputLabel styleClass="form-check-label"
                                               value="#{capitalizeConverter.capitalize(diff)}"/>
                            </div>

                        </ui:repeat>

                        <h:inputHidden id="selectedDiff" binding="#{hiddenIt}"
                                       value="#{questionSetBean.questionSet.difficulty}"
                                       rendered="#{facesContext.currentPhaseId.ordinal ne 6}"/>
                    </div>
                </div>

                <div class="row py-5 pb-md-5">
                    <div class="col text-center">
                        <h:commandButton styleClass="btn btn-block btn-primary btn-lg" id="saveQuestion"
                                         action="#{questionSetBean.saveNewQuestionSet}" value="Step 2: Add questions"/>
                    </div>
                </div>

            </h:form>

            <h:form id="setTypeForm" rendered="#{questionSetBean.questionSet.name != null}">
                <div class="container-fluid mx-0 px-0 my-5">
                    <div class="row">
                        <ui:repeat id="items" value="#{questionSetBean.types}" var="item">
                            <div class="form-check form-check-inline w-50 mx-0 px-0 justify-content-center">
                                <input type="radio" class="form-check-input" jsf:id="item"
                                       pt:name="#{hiddenItem.clientId}"
                                       value="#{item}"
                                       pt:checked="#{item eq questionSetBean.question.type ? 'checked' : null}">
                                    <f:ajax event="click" render="questionForm"/>
                                </input>
                                <h:outputLabel styleClass="form-check-label"
                                               value="#{capitalizeConverter.capitalize(item)}"/>
                            </div>

                        </ui:repeat>

                        <h:inputHidden id="selectedItem" binding="#{hiddenItem}"
                                       value="#{questionSetBean.question.type}"
                                       rendered="#{facesContext.currentPhaseId.ordinal ne 6}"/>
                    </div>
                </div>
            </h:form>

            <h:form id="questionForm" rendered="#{questionSetBean.questionSet.name != null}">
                <div class="form-group">
                    <label for="question">Question</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.questionString}"
                                 name="question" id="question" pt:autocomplete="off" pt:required="true" pt:pattern="[\s\S]*\S[\s\S]*"/>
                    <h:message for="question" styleClass="state-error"/>
                </div>

                <div class="form-group">
                    <label for="corrAnswer">Correct answer</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.rightAnswerString}"
                                 rendered="#{questionSetBean.question.type == 'text'}"
                                 name="corrAnswer" id="corrAnswer" pt:autocomplete="off" pt:required="true" pt:pattern="[\s\S]*\S[\s\S]*"/>

                    <qc:upload target="#{questionSetBean.file}"
                               listenerString="#{questionSetBean.handleFileUpload('rightAnswerString', questionSetBean.question, questionSetBean.questionSet.id.toString())}"
                               listener="#{questionSetBean.none}"
                               accept="image/*"
                               text="Upload Picture"
                               rendered="#{questionSetBean.question.type == 'picture'}"
                               required="true"
                               update="questionForm:rightAnswerString"
                    />

                    <h:panelGroup layout="block" id="rightAnswerString" styleClass="preview-overview" rendered="#{questionSetBean.question.type == 'picture'}">
                        <h:graphicImage pt:id="preview" value="#{answerPictureBean.getAnswers((questionSetBean.filename == null ? questionSetBean.question.rightAnswerString : questionSetBean.filename))}" alt="Question picture" />
                    </h:panelGroup>
                </div>

                <div class="form-group">
                    <label for="wrongAnswer1">Wrong answer #1</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.wrongAnswerString_1}" name="wrongAnswer1"
                                 rendered="#{questionSetBean.question.type == 'text'}"
                                 pt:required="true" id="wrongAnswer1" pt:autocomplete="off" pt:pattern="[\s\S]*\S[\s\S]*"/>
                    <qc:upload target="#{questionSetBean.file}"
                               listenerString="#{questionSetBean.handleFileUpload('wrongAnswerString_1', questionSetBean.question, questionSetBean.questionSet.id.toString())}"
                               listener="#{questionSetBean.none}"
                               accept="image/*"
                               text="Upload Picture"
                               rendered="#{questionSetBean.question.type == 'picture'}"
                               required="true"
                               update="questionForm:wrongAnswer1Pic"
                    />

                    <h:panelGroup layout="block" id="wrongAnswer1Pic" styleClass="preview-overview" rendered="#{questionSetBean.question.type == 'picture'}">
                        <h:graphicImage pt:id="preview" value="#{answerPictureBean.getAnswers((questionSetBean.filename == null ? questionSetBean.question.wrongAnswerString_1 : questionSetBean.filename))}" alt="Question picture" />
                    </h:panelGroup>
                </div>

                <div class="form-group">
                    <label for="wrongAnswer2">Wrong answer #2</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.wrongAnswerString_2}" name="wrongAnswer2"
                                 rendered="#{questionSetBean.question.type == 'text'}"
                                 id="wrongAnswer2" pt:autocomplete="off" pt:pattern="[\s\S]*\S[\s\S]*"/>

                    <qc:upload target="#{questionSetBean.file}"
                               listenerString="#{questionSetBean.handleFileUpload('wrongAnswerString_2', questionSetBean.question, questionSetBean.questionSet.id.toString())}"
                               listener="#{questionSetBean.none}"
                               accept="image/*"
                               text="Upload Picture"
                               rendered="#{questionSetBean.question.type == 'picture'}"
                               update="questionForm:wrongAnswer2Pic"
                    />
                    <h:panelGroup layout="block" id="wrongAnswer2Pic" styleClass="preview-overview" rendered="#{questionSetBean.question.type == 'picture'}">
                        <h:graphicImage pt:id="preview" value="#{answerPictureBean.getAnswers((questionSetBean.filename == null ? questionSetBean.question.wrongAnswerString_2 : questionSetBean.filename))}" alt="Question picture" />
                    </h:panelGroup>
                </div>

                <div class="form-group">
                    <label for="wrongAnswer3">Wrong answer #3</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.wrongAnswerString_3}" name="wrongAnswer3"
                                 rendered="#{questionSetBean.question.type == 'text'}"
                                 id="wrongAnswer3" pt:autocomplete="off" pt:pattern="[\s\S]*\S[\s\S]*"/>

                    <qc:upload target="#{questionSetBean.file}"
                               listenerString="#{questionSetBean.handleFileUpload('wrongAnswerString_3', questionSetBean.question, questionSetBean.questionSet.id.toString())}"
                               listener="#{questionSetBean.none}"
                               accept="image/*"
                               text="Upload Picture"
                               rendered="#{questionSetBean.question.type == 'picture'}"
                               update="questionForm:wrongAnswer3Pic"
                    />

                    <h:panelGroup layout="block" id="wrongAnswer3Pic" styleClass="preview-overview" rendered="#{questionSetBean.question.type == 'picture'}">
                        <h:graphicImage pt:id="preview" value="#{answerPictureBean.getAnswers((questionSetBean.filename == null ? questionSetBean.question.wrongAnswerString_3 : questionSetBean.filename))}" alt="Question picture" />
                    </h:panelGroup>
                </div>

                <div class="form-group">
                    <label for="wrongAnswer4">Wrong answer #4</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.wrongAnswerString_4}" name="wrongAnswer4"
                                 rendered="#{questionSetBean.question.type == 'text'}"
                                 id="wrongAnswer4" pt:autocomplete="off" pt:pattern="[\s\S]*\S[\s\S]*"/>

                    <qc:upload target="#{questionSetBean.file}"
                               listenerString="#{questionSetBean.handleFileUpload('wrongAnswerString_4', questionSetBean.question, questionSetBean.questionSet.id.toString())}"
                               listener="#{questionSetBean.none}"
                               accept="image/*"
                               text="Upload Picture"
                               rendered="#{questionSetBean.question.type == 'picture'}"
                               update="questionForm:wrongAnswer4Pic"
                    />

                    <h:panelGroup layout="block" id="wrongAnswer4Pic" styleClass="preview-overview" rendered="#{questionSetBean.question.type == 'picture'}">
                        <h:graphicImage pt:id="preview" value="#{answerPictureBean.getAnswers((questionSetBean.filename == null ? questionSetBean.question.wrongAnswerString_4 : questionSetBean.filename))}" alt="Question picture" />
                    </h:panelGroup>
                </div>

                <div class="form-group">
                    <label for="wrongAnswer5">Wrong answer #5</label>
                    <h:inputText type="text" styleClass="form-control"
                                 value="#{questionSetBean.question.wrongAnswerString_5}" name="wrongAnswer5"
                                 rendered="#{questionSetBean.question.type == 'text'}"
                                 id="wrongAnswer5" pt:autocomplete="off" pt:pattern="[\s\S]*\S[\s\S]*"/>
                    <qc:upload target="#{questionSetBean.file}"
                               listenerString="#{questionSetBean.handleFileUpload('wrongAnswerString_5', questionSetBean.question, questionSetBean.questionSet.id.toString())}"
                               listener="#{questionSetBean.none}"
                               accept="image/*"
                               text="Upload Picture"
                               rendered="#{questionSetBean.question.type == 'picture'}"
                               update="questionForm:wrongAnswer5Pic"
                    />

                    <h:panelGroup layout="block" id="wrongAnswer5Pic" styleClass="preview-overview" rendered="#{questionSetBean.question.type == 'picture'}">
                        <h:graphicImage pt:id="preview" value="#{answerPictureBean.getAnswers((questionSetBean.filename == null ? questionSetBean.question.wrongAnswerString_5 : questionSetBean.filename))}" alt="Question picture" />
                    </h:panelGroup>
                </div>


                <h:commandButton styleClass="btn btn-block btn-primary btn-lg" pt:id="submitNew"
                                 value="Save" pt:type="submit">
                </h:commandButton>

                <script type="text/javascript">
                    $('#questionForm').submit(function(e){
                        console.log('invoked modal.js from inline script');
                        e.preventDefault();
                        console.log('prevented Default from modal.js from inline script');
                        $("#questionModal").modal({
                            show : true,
                            keyboard : false,
                            backdrop : 'static'
                        });
                        console.log('show modal from inline script');
                    });

                </script>

                <qc:modal target="questionModal" closable="false" modaltype="question" title="Another one?" abort="No" confirm="Yes" confirmAction="#{questionSetBean.saveNewQuestion}" abortAction="#{questionSetBean.exitCreateQuestionSet}" update=":setTypeForm @form">
                    <h2>Do you want to add another question?</h2>
                </qc:modal>
            </h:form>
        </div>
    </ui:define>

    <ui:define name="site-specific-javascript">
        <script type="text/javascript" src="/resources/js/modal.js"/>
    </ui:define>
</ui:composition>