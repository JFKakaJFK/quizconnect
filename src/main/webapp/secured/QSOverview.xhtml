<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:qc="http://java.sun.com/jsf/composite/quizconnect"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:cc="http://java.sun.com/jsf/composite"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/templates/main.xhtml">

    <ui:define name="site-specific-css">
        <link rel="stylesheet" type="text/css" href="/resources/css/QSOverview.css"/>
        <script type="text/javascript" src="../resources/quizconnect/js/QCUpload.js"></script>
    </ui:define>

    <ui:define name="content">
        <div class="container pt-5 pb-5 reduced-mobile-spacing">
            <div class="row py-3">
                <div class="col-lg">
                    <h1 class="display-4 text-center">Overview Question-Sets</h1>
                </div>
            </div>
        </div>

        <h:form>
            <div class="row justify-content-center">
                <div class="col-3">
                    <h:commandButton styleClass="btn btn-block btn-primary btn-lg"
                                     id="CreateNew"
                                     action="/secured/questionSet.xhtml?faces-redirect=true" value="Create new"/>
                </div>
                <div class="col-3">
                    <h:commandLink styleClass="btn btn-block btn-primary btn-lg"
                                   p:data-toggle="modal" p:data-target="#uploadCSV"
                                   p:data-backdrop="static" value="Upload CSV"
                                   onclick="#{CSVImportBean.setManager(sessionInfoBean.currentUser.manager)}">
                        <f:ajax execute="@form" render="@none"/>
                    </h:commandLink>
                </div>
            </div>
        </h:form>

        <form jsf:id="formId">
            <h:panelGroup layout="block" styleClass="container" rendered="#{QSOverviewBean.questionSets == null}">
                <h1 class="display-4">No QuestionSets found</h1>
                <h:commandButton styleClass="btn btn-primary" action="all?faces-redirect=true" value="All Players"/>
            </h:panelGroup>

            <qc:modal id="modal"
                      target="uploadCSV"
                      title="Upload .csv file"
                      closeAction="#{CSVImportBean.abort}"
                      abortAction="#{CSVImportBean.abort}"
                      confirmAction="#{CSVImportBean.processCSV}"
                      update="@form"
                      bodyId="body"
                      footerId="footer">

                <qc:upload target="#{CSVImportBean.file}"
                           listener="#{CSVImportBean.handleFileUpload}"
                           accept=".csv"
                           update=":form:modal:body :form:modal:footer"
                           text="Upload CSV"
                           />

                <div jsf:id="preview" class="preview">
                    <h:outputText p:id="preview"
                                  value="TODO"
                                  alt="File"/>
                </div>

                <div class="form-group">
                    <label for="nameCSV">Name</label>
                    <h:inputText styleClass="form-control" id="nameCSV" value="#{CSVImportBean.nameCSV}"
                                 p:required="true" p:pattern="[\s\S]*\S[\s\S]*"></h:inputText>
                </div>

                <div class="form-group">
                    <label for="descriptionCSV">Description</label>
                    <h:inputText styleClass="form-control" id="descriptionCSV" value="#{CSVImportBean.descriptionCSV}"
                                 p:required="true" p:pattern="[\s\S]*\S[\s\S]*"></h:inputText>
                </div>
            </qc:modal>
        </form>


        <h:form id="formOverview-QSets">
            <h:panelGroup id="overview-QSets" layout="block" rendered="#{QSOverviewBean.questionSets != null}"
                          styleClass="boxes px-3">


                <ui:repeat value="#{QSOverviewBean.questionSets}" var="set">
                    <qc:generic-box size="sm"
                                    showEdit="#{QSOverviewBean.isByManager(set)}"
                                    editIcon="fas fa-edit"
                                    editAction="#{editQuestionBean.setAndRedirect(set.id)}"
                                    showDelete="#{QSOverviewBean.isByManager(set)}"
                                    deleteIcon="fas fa-trash"
                                    deleteAction="#{QSOverviewBean.deleteQuestionSet(set)}">
                        <h3>#{set.name}</h3>
                        <h3>#{set.description}</h3>
                        <div class="row">
                            <h3 class="col-md-6">#{set.difficulty}</h3>
                            <h3 class="col-md-6">#{set.questions.size()}</h3>
                        </div>
                    </qc:generic-box>
                </ui:repeat>
            </h:panelGroup>

        </h:form>

    </ui:define>
</ui:composition>