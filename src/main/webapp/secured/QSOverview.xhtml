<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:qc="http://java.sun.com/jsf/composite/quizconnect"
                xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:cc="http://java.sun.com/jsf/composite"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:jsf="http://xmlns.jcp.org/jsf"
                template="/WEB-INF/templates/main.xhtml">

    <ui:define name="title">Question sets</ui:define>

    <ui:define name="site-specific-css">
        <link rel="stylesheet" type="text/css" href="/resources/css/QSOverview.css"/>
        <script type="text/javascript" src="../resources/quizconnect/js/QCUpload.js"></script>
    </ui:define>

    <ui:define name="content">
        <h:form>
            <div class="row justify-content-center">
                <div class="col-3">
                    <h:commandButton styleClass="btn btn-primary"
                                     id="CreateNew"
                                     action="/secured/questionSet.xhtml?faces-redirect=true" value="Create new"/>
                </div>
                <div class="col-3">
                    <h:commandLink styleClass="btn btn-primary"
                                   p:data-toggle="modal" p:data-target="#uploadCSV"
                                   p:data-backdrop="static" value="Upload CSV"
                                   onclick="#{CSVImportBean.setManager(sessionInfoBean.currentUser.manager)}">
                        <f:ajax execute="@form" render="@none"/>
                    </h:commandLink>
                </div>
            </div>
        </h:form>

        <form jsf:id="formId">
            <h:panelGroup layout="block" styleClass="container" rendered="#{QSOverviewBean.questionSets == null}">
                <h1 class="display-4">No QuestionSets found</h1>
                <h:commandButton styleClass="btn btn-primary" action="all?faces-redirect=true" value="All Players"/>
            </h:panelGroup>

            <qc:modal id="modal"
                      target="uploadCSV"
                      title="Upload .csv file"
                      closeAction="#{CSVImportBean.abort}"
                      abortAction="#{CSVImportBean.abort}"
                      confirmAction="#{CSVImportBean.processCSV}"
                      update="@form"
                      bodyId="body"
                      footerId="footer">

                <qc:upload target="#{CSVImportBean.file}"
                           listener="#{CSVImportBean.handleFileUpload}"
                           accept=".csv"
                           update=":form:modal:body :form:modal:footer"
                           text="Upload CSV"
                           />

                <div jsf:id="preview" class="preview">
                    <h:outputText p:id="preview"
                                  value="TODO"
                                  alt="File"/>
                </div>

                <div class="form-group">
                    <label for="nameCSV">Name</label>
                    <h:inputText styleClass="form-control" id="nameCSV" value="#{CSVImportBean.nameCSV}"
                                 p:required="true" p:pattern="[\s\S]*\S[\s\S]*"></h:inputText>
                </div>

                <div class="form-group">
                    <label for="descriptionCSV">Description</label>
                    <h:inputText styleClass="form-control" id="descriptionCSV" value="#{CSVImportBean.descriptionCSV}"
                                 p:required="true" p:pattern="[\s\S]*\S[\s\S]*"></h:inputText>
                </div>
            </qc:modal>
        </form>


        <h:form id="formOverview-QSets">

            <h:panelGroup layout="block" styleClass="searchbar">

                <h:inputText id="searchPrase" p:autocomplete="nein-danke-bitte-nicht" p:placeholder="Search" value="#{QSOverviewBean.searchPhrase}" styleClass="form-control searchbar-search">
                    <f:ajax listener="#{QSOverviewBean.handleSearch}" event="keyup" execute="@this" render="questionset-collection"/>
                </h:inputText>

                <h:panelGroup id="showByManager" styleClass="searchbar-action">
                    <h:selectBooleanCheckbox p:id="showByManager" value="#{QSOverviewBean.onlyByManager}" styleClass="jsf-hide">
                        <f:ajax listener="#{QSOverviewBean.setOnlyByManager(!QSOverviewBean.onlyByManager)}" render="showByManager questionset-collection"/>
                    </h:selectBooleanCheckbox>

                    <label for="showByManager">
                        #{QSOverviewBean.onlyByManager ? 'Show all players' : 'Show only your Players'}
                    </label>
                </h:panelGroup>

                <h:commandButton styleClass="btn btn-secondary searchbar-action" p:data-toggle="modal" p:data-target="#addPlayer" value="Add Player" rendered="#{sessionInfoBean.hasRole('MANAGER')}">
                    <f:ajax execute="@this" render=":form:addPlayer:footer :form:addPlayer:body"/>
                </h:commandButton>

            </h:panelGroup>


            <h:panelGroup styleClass="collection" id="questionset-collection" layout="block" rendered="#{QSOverviewBean.questionSets != null}">

                    <ui:repeat value="#{QSOverviewBean.paginator.parts}" var="part">
                        <ui:repeat value="#{part.items}" var="set">
                            <qc:questionsetbox questionset="#{set}">
                                <h:commandLink styleClass="box-action" p:data-toggle="modal" p:data-target="#deleteQuestionset" rendered="#{QSOverviewBean.isByManager(set)}">
                                    <svg viewBox="0 0 24 24" width="24" height="24"><path class="heroicon-ui" d="M8 6V4c0-1.1.9-2 2-2h4a2 2 0 0 1 2 2v2h5a1 1 0 0 1 0 2h-1v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8H3a1 1 0 1 1 0-2h5zM6 8v12h12V8H6zm8-2V4h-4v2h4zm-4 4a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0v-6a1 1 0 0 1 1-1zm4 0a1 1 0 0 1 1 1v6a1 1 0 0 1-2 0v-6a1 1 0 0 1 1-1z"/></svg>                                    <f:ajax execute="@form" render="@none" />
                                    <f:ajax execute="@this" render="@none"/>
                                    <f:setPropertyActionListener value="#{set}" target="#{QSOverviewBean.questionsetToDelete}"/>
                                </h:commandLink>

                                <h:commandLink styleClass="box-action" action="#{editQuestionBean.setAndRedirect(set.id)}" rendered="#{QSOverviewBean.isByManager(set)}">
                                    <svg viewBox="0 0 24 24" width="24" height="24"><path class="heroicon-ui" d="M9 4.58V4c0-1.1.9-2 2-2h2a2 2 0 0 1 2 2v.58a8 8 0 0 1 1.92 1.11l.5-.29a2 2 0 0 1 2.74.73l1 1.74a2 2 0 0 1-.73 2.73l-.5.29a8.06 8.06 0 0 1 0 2.22l.5.3a2 2 0 0 1 .73 2.72l-1 1.74a2 2 0 0 1-2.73.73l-.5-.3A8 8 0 0 1 15 19.43V20a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-.58a8 8 0 0 1-1.92-1.11l-.5.29a2 2 0 0 1-2.74-.73l-1-1.74a2 2 0 0 1 .73-2.73l.5-.29a8.06 8.06 0 0 1 0-2.22l-.5-.3a2 2 0 0 1-.73-2.72l1-1.74a2 2 0 0 1 2.73-.73l.5.3A8 8 0 0 1 9 4.57zM7.88 7.64l-.54.51-1.77-1.02-1 1.74 1.76 1.01-.17.73a6.02 6.02 0 0 0 0 2.78l.17.73-1.76 1.01 1 1.74 1.77-1.02.54.51a6 6 0 0 0 2.4 1.4l.72.2V20h2v-2.04l.71-.2a6 6 0 0 0 2.41-1.4l.54-.51 1.77 1.02 1-1.74-1.76-1.01.17-.73a6.02 6.02 0 0 0 0-2.78l-.17-.73 1.76-1.01-1-1.74-1.77 1.02-.54-.51a6 6 0 0 0-2.4-1.4l-.72-.2V4h-2v2.04l-.71.2a6 6 0 0 0-2.41 1.4zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>                                    <f:ajax execute="@form" render="@none" />
                                </h:commandLink>

                            </qc:questionsetbox>
                        </ui:repeat>
                    </ui:repeat>

            </h:panelGroup>

            <qc:modal id="deleteQuestionset"
                      target="deleteQuestionset"
                      title="Delete Questionset"
                      confirm="Delete Questionset"
                      abort="Cancel"
                      confirmAction="#{QSOverviewBean.deleteQuestionSet}"
                      update=":formOverview-QSets:questionset-collection">
                Are you sure? This cannot be undone.
            </qc:modal>
        </h:form>

    </ui:define>
</ui:composition>