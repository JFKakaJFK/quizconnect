<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://java.sun.com/jsf/composite"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xml:lang="en"
      lang="en">
<cc:interface>

    <!--=============================================

    !!!!!!!!!!!!       IMPORTANT         !!!!!!!!!!!!

    1. h:form needs enctype="multipart/form-data"
    2. QCUpload.js needs to be imported
    3. The backing bean must have a property of type
       java.io.File w/ Getters & Setters
    4. The backing bean must have a method which
       handles upload events

    !!! currently only 1 upload per page(reuse)

    ===============    ATTRIBUTES    ================

    - accept ... HTML5 input[type="file"] accept attr
    - target ... property of type java.io.File
    - styleClass ... HTML class
    - listener ... bean method
    - update ... components to update

    ==============================================-->

    <cc:attribute name="listener" required="true" method-signature="void listener()"/>
    <cc:attribute name="target" required="true" type="java.io.File"/>
    <cc:attribute name="id" required="false" default="upload"/>
    <cc:attribute name="text" required="false" default="Upload File" />
    <cc:attribute name="accept" required="false" default="*/*" />
    <cc:attribute name="styleClass" required="false" default=""/>
    <cc:attribute name="update" required="false" default="@none" />
</cc:interface>

<cc:implementation> <!-- TODO change name to attribute & generate unique ids + handle all @RequestParams in the backend => mulitple uploads -->
    <input type="file" accept="#{cc.attrs.accept}" name="files[]" id="#{cc.clientId}:#{cc.attrs.id}" class="invisible"/>
    <label for="#{cc.clientId}:#{cc.attrs.id}" class="btn btn-primary #{cc.attrs.styleClass}">Upload File</label>
    <h:commandButton styleClass="upload jsf-hide" action="#{cc.attrs.listener}">
        <f:setPropertyActionListener value="#{uploadService.getUpload(sessionInfoBean.currentUser)}" target="#{cc.attrs.target}"/>
        <f:ajax execute="@this" render="#{cc.attrs.update}" />
    </h:commandButton>
    <h:outputScript>
        QCUpload.upload('#{sessionInfoBean.currentUserName}', '#{cc.clientId}:#{cc.attrs.id}');
    </h:outputScript>
</cc:implementation>
</html>